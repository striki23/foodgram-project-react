# Сайт Foodgram «Продуктовый помощник»

![example workflow](https://github.com/striki23/foodgram-project-react/actions/workflows/foodgram.yml/badge.svg)

---
### Стэк технологий:
[![Python](https://img.shields.io/badge/-Python-464646?style=flat-square&logo=Python)](https://www.python.org/)
[![Django](https://img.shields.io/badge/-Django-464646?style=flat-square&logo=Django)](https://www.djangoproject.com/)
[![Django REST Framework](https://img.shields.io/badge/-Django%20REST%20Framework-464646?style=flat-square&logo=Django%20REST%20Framework)](https://www.django-rest-framework.org/)
[![PostgreSQL](https://img.shields.io/badge/-PostgreSQL-464646?style=flat-square&logo=PostgreSQL)](https://www.postgresql.org/)
[![Nginx](https://img.shields.io/badge/-NGINX-464646?style=flat-square&logo=NGINX)](https://nginx.org/ru/)
[![gunicorn](https://img.shields.io/badge/-gunicorn-464646?style=flat-square&logo=gunicorn)](https://gunicorn.org/)
[![docker](https://img.shields.io/badge/-Docker-464646?style=flat-square&logo=docker)](https://www.docker.com/)
[![Yandex.Cloud](https://img.shields.io/badge/-Yandex.Cloud-464646?style=flat-square&logo=Yandex.Cloud)](https://cloud.yandex.ru/)

---
## **Адрес проекта**
http://84.252.141.69/admin/ Панель администратора<br>
http://84.252.141.69/api/docs/ Документация<br>
http://84.252.141.69/signin Вход на сайт и регистрация<br>
http://84.252.141.69/recipes Главная страница рецептов<br>
http://84.252.141.69/subscriptions Подписки<br>
http://84.252.141.69/recipes/create Создание рецепта<br>
http://84.252.141.69/favorites Избранное<br>
http://84.252.141.69/cart Список покупок

---
## Техническое описание проекта
Сайт, на котором пользователи могут публиковать рецепты, добавлять чужие рецепты в избранное и подписываться на публикации других авторов. Сервис «Список покупок» позволит пользователям создавать и скачивать список продуктов, которые нужно купить для приготовления выбранных блюд.

### Сервисы и страницы проекта
#### Главная страница
Содержимое главной страницы — список первых шести рецептов, отсортированных по дате публикации (от новых к старым). Остальные рецепты доступны на следующих страницах: внизу страницы есть пагинация.

#### Страница рецепта
На странице — полное описание рецепта. Для авторизованных пользователей — возможность добавить рецепт в избранное и в список покупок, возможность подписаться на автора рецепта.

#### Страница пользователя
На странице — имя пользователя, все рецепты, опубликованные пользователем и возможность подписаться на пользователя.

#### Подписка на авторов
Подписка на публикации доступна только авторизованному пользователю. Страница подписок доступна только владельцу.

- Сценарий поведения пользователя:

Пользователь переходит на страницу другого пользователя или на страницу рецепта и подписывается на публикации автора кликом по кнопке «Подписаться на автора».
Пользователь переходит на страницу «Мои подписки» и просматривает список рецептов, опубликованных теми авторами, на которых он подписался. Сортировка записей — по дате публикации (от новых к старым)
При необходимости пользователь может отказаться от подписки на автора: переходит на страницу автора или на страницу его рецепта и нажимает «Отписаться от автора».

#### Список избранного
Работа со списком избранного доступна только авторизованному пользователю. Список избранного может просматривать только его владелец.

- Сценарий поведения пользователя:

Пользователь отмечает один или несколько рецептов кликом по кнопке «Добавить в избранное».
Пользователь переходит на страницу «Список избранного» и просматривает персональный список избранных рецептов.
При необходимости пользователь может удалить рецепт из избранного.

#### Список покупок
Работа со списком покупок доступна авторизованным пользователям. Список покупок может просматривать только его владелец.

- Сценарий поведения пользователя:

Пользователь отмечает один или несколько рецептов кликом по кнопке «Добавить в покупки».
Пользователь переходит на страницу Список покупок, там доступны все добавленные в список рецепты. Пользователь нажимает кнопку Скачать список и получает файл с суммированным перечнем и количеством необходимых ингредиентов для всех рецептов, сохранённых в «Списке покупок».
При необходимости пользователь может удалить рецепт из списка покупок. Список покупок скачивается в формате .txt (или, по желанию, можно сделать выгрузку PDF).
При скачивании списка покупок ингредиенты в результирующем списке не должны дублироваться; если в двух рецептах есть сахар (в одном рецепте 5 г, в другом — 10 г), то в списке должен быть один пункт: Сахар — 15 г.

В результате список покупок может выглядеть так:

- Фарш (баранина и говядина) (г) — 600
- Сыр плавленый (г) — 200
- Лук репчатый (г) — 55
- Картофель (г) — 1000

## Инструкция по запуску проекта на удаленном сервере:
#### 1. Подключиться и авторизоваться на удаленном сервере:
```
ssh <имя_сервера>@<публичный_ip_сервера>
```
#### 2. Установите docker и docker-compose:
* Установка docker:
```
sudo apt install docker.io
```
* Установка docker-compose:
```
sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```
#### 3. Найстройка nginx.conf и docker-compose.yml:
* Отредактируйте файл infra/nginx.conf и в строке server_name замените IP по умолчанию на свой IP
* Скопируйте файлы docker-compose.yml и nginx.conf из директории infra в директорию /home/<username>
```
sudo cp docker-compose.yml /home/<username>/
sudo cp nginx.conf /home/<username>/
```

#### 3.1 Дополнительно. Создание .env файла для локального запуска:
* Важно! Если решите запустить проект локально, для работы и запуска потребуется .env файл.
* Внутри самого проекта. В папке backend/foodgram/ на уровне файла settings.py
* Создайте файл .env:
```
sudo touch .env
```
* Откройте файл .env:
```
sudo nano .env
```
* заполните файл соответствующими данными:
```
    SECRET_KEY=<секретный ключ проекта django>
    DB_ENGINE=<django.db.backends.postgresql>
    DB_NAME=<имя базы данных postgres>
    POSTGRES_USER=<пользователь бд>
    POSTGRES_PASSWORD=<пароль>
    DB_HOST=<db>
    DB_PORT=<5432>
    DEBUG=<настройки Дебага>
    ALLOWED_HOSTS=<список разрешенных хостов/доменов>
```
* Примечание! При автоматическом deploy и развертывание проекта на сервере, данный файл создается автоматически.

#### 4. Подготовка и запуск Workflow:
* Для работы с Workflow добавьте в Secrets GitHub переменные окружения для работы:
```
    SECRET_KEY=<секретный ключ проекта django>
    DB_ENGINE=<django.db.backends.postgresql>
    DB_NAME=<имя базы данных postgres>
    POSTGRES_USER=<пользователь бд>
    POSTGRES_PASSWORD=<пароль>
    DB_HOST=<db>
    DB_PORT=<5432>
    DEBUG=<настройки Дебага>
    ALLOWED_HOSTS=<список разрешенных хостов/доменов>
    DOCKERHUB_PASSWORD=<пароль от DockerHub>
    DOCKERHUB_LOGIN=<имя пользователя на DockerHub>
    TELEGRAM_TO=<ID чата, в который придет сообщение>
    TELEGRAM_TOKEN=<токен вашего бота>
```

#### 5. Сборка образа и запуск docker-compose:
* Для ручного запуска проекта.
  По пути foodgram-project-react/infra запустите docker-compose:
```
sudo docker-compose up -d --build
```

#### 6. Создание таблиц БД и сбор файлов статики:
* Примечание! Данные команды необходимы при ручном запуске. В Workflow данные команды выполняются автоматически.

* Подготовка к миграциям внутри контейнера:
```
sudo docker-compose exec backend python manage.py makemigrations --noinput
```
* Запуск миграций:
```
sudo docker-compose exec backend python manage.py migrate --noinput
```
* Сбор файлов статики:
```
sudo docker-compose exec backend python manage.py collectstatic --noinput
```
* Загрузка в БД списка ингредиентов:
```
sudo docker-compose exec backend python manage.py import_data
```
* Создайте суперпользователя с правами администратора:
```
sudo docker-compose exec backend python manage.py createsuperuser
```
### Тестовые пользователи
Логин: ```admin``` (суперюзер)  
Email: ```admin@mail.ru```  
Пароль: ```change_me```  

Логин: ```user1```  
Email: ```user1@mail.ru```  
Пароль: ```user25354```  

Логин: ```user2```  
Email: ```user2@mail.ru```  
Пароль: ```user25688```
```
Автор: [Демидова Дарья](https://github.com/striki23)
```